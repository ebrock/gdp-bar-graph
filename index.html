<!DOCTYPE html>
<html>

<head>
	<title>United States GDP</title>
	<meta charset="utf-8" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.12.0/d3.js" charset="utf-8"></script>
</head>

<style>
	.bar:hover {
		fill: gray;
	}
</style>

<body>
	<script type="text/javascript">
		// Create XML request to get data.
		var req = new XMLHttpRequest();
		req.open(
			"GET",
			"https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json",
			true
		);

		// onload is a function called when XMLHttpRequest transaction completes.
		req.onload = function() {
			var json = JSON.parse(req.responseText);
			var dataset = json.data;
			var newdata = [];

			// log out dataset.
			dataset.forEach(d => {
				// dataset[0] -> date
				console.log(d[0]);
				// dataset[1] -> gdp
				console.log(d[1]);
			})

			// log out min / max
			console.log(d3.min(dataset, (d) => d[0]));
			console.log(d3.min(dataset, (d) => d[1]));
			console.log(d3.max(dataset, (d) => d[0]));
			console.log(Date(d3.max(dataset, (d) => d[1])));


			if (req.status >= 200 && req.status < 400) {
				dataset.forEach(d => {
					newdata.push([d[0].match(/\d{4}/gm).toString(), d[1]]);
				})
			} else {
				console.log("error");
			}

			const w = 1000;
			const h = 500;
			const padding = 60;

			// Create x scale (year).
			const xScale = d3.scaleLinear()
											 .domain([d3.min(dataset, (d) => d[0].match(/\d{4}/gm)), d3.max(dataset, (d) => d[0]).match(/\d{4}/gm)]) // "D for Domain, D for Data"
											 .range([padding, (w - padding)]); // Scaled range transformed raw data.

			// Create y scale (GDP).
			const yScale = d3.scaleLinear()
											 .domain([0, d3.max(dataset, (d) => d[1])])
											 .range([(h - padding), padding]);

			// Create svg.
			const svg = d3.select("body")
										.append("svg")
										.attr("width", w)
										.attr("height", h);

			// Add rects to svg.
			svg.selectAll("rect")
				 .data(newdata)
				 .enter()
				 .append("rect")
				 .attr("fill", "#193c75")
				 .attr("class", "bar")
				 .attr("x", (d, i) => {
					 return xScale(d[0], (i * 20));
				 })
				 .attr("y", (d, i) => {
					 // - padding
					 return yScale(d[1]);
				 })
				 .attr("width", 4)
				 .attr("height", (d, i) => {
					 return h - yScale(d[1]) - padding;
				 })
				 // Add tool-tip.
				 .append("title")
				 .text((d) => d[1]);

			// Create axes.
			const xAxis = d3.axisBottom(xScale).tickFormat(d3.format("d"));
			const yAxis = d3.axisLeft(yScale).tickFormat(d3.format("$,.0f"));

			svg.append("g")
				 .attr("transform", "translate(0, " + (h - padding) + ")")
				 .call(xAxis);

			svg.append("g")
				 .attr("transform", "translate(" + padding + ", 0)")
				 .call(yAxis);

		};

		req.send();

		d3.select("body")
	  	.append("h1")
			.attr("id", "title")
	  	.text("United States GDP");

	</script>

	<div id="app">
	</div>
</body>

</html>
